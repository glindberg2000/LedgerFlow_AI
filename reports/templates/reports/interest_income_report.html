{% extends "admin/base_site.html" %}
{% load admin_urls %}
{% block content %}
<div style="margin-bottom: 1em;">
    <a href="{% url 'admin:reports_reportsproxy_irs' %}" class="button">IRS 6A</a>
    <a href="{% url 'admin:reports_reportsproxy_categories' %}" class="button">All Categories</a>
    <a href="{% url 'admin:reports_reportsproxy_interest' %}" class="button">Interest Income</a>
</div>
<form method="get">
    {{ form.as_p }}
    <input type="submit" value="Filter" />
</form>
{% if selected_client %}
<div style="margin: 1em 0;">
    <a href="?client={{ selected_client.client_id }}&download=pdf" class="button"
        style="background-color: #417690; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px;">
        <span style="margin-right: 5px;">ðŸ“¥</span> Download PDF Report
    </a>
</div>
<h3>Client: {{ selected_client.client_id }}</h3>
<table border="1" cellpadding="4" cellspacing="0" style="width: 100%;">
    <tr>
        <th>Source</th>
        <th>Bank</th>
        <th>Account</th>
        <th>Statement Type</th>
        <th>Number of Transactions</th>
        <th>Total Amount</th>
    </tr>
    {% for group in interest_transactions %}
    <tr>
        <td>{{ group.source }}</td>
        <td>{{ group.account_info.bank|default:"N/A" }}</td>
        <td>{{ group.account_info.account_number|default:"N/A" }}</td>
        <td>{{ group.account_info.statement_type|default:"N/A" }}</td>
        <td>{{ group.transactions|length }}</td>
        <td>${{ group.subtotal|floatformat:2 }}</td>
    </tr>
    <tr>
        <td colspan="6" style="background-color: #f9f9f9;">
            <table style="width: 100%; margin: 0.5em 0;">
                <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Source</th>
                    <th>Amount</th>
                    <th>Source File</th>
                </tr>
                {% for tx in group.transactions %}
                <tr>
                    <td>{{ tx.transaction_date|date:"Y-m-d" }}</td>
                    <td>{{ tx.description }}</td>
                    <td>{{ tx.source|default:"N/A" }}</td>
                    <td>${{ tx.amount|floatformat:2 }}</td>
                    <td>{{ tx.statement_file.file_name|default:"N/A" }}</td>
                </tr>
                {% endfor %}
            </table>
        </td>
    </tr>
    {% endfor %}
    <tr>
        <td colspan="5"><strong>Total Interest Income</strong></td>
        <td><strong>${{ total|floatformat:2 }}</strong></td>
    </tr>
</table>
{% elif client_id %}
<p style="color:red;">Client not found.</p>
{% endif %}
{% endblock %}